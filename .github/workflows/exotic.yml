name: Run tests

on: [push]

jobs:

  run_tests:

    runs-on: ubuntu-18.04
    name: Build on ${{ matrix.distro }} ${{ matrix.arch }}

    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: armv6
          - arch: armv7
          - arch: aarch64
          - arch: ppc64le
          - arch: s390x

    steps:
      - uses: actions/checkout@v2.1.0
        with:
          fetch-depth: 0
      - name: Fetch all tags
        run: git fetch --tags --all
      - uses: uraimo/run-on-arch-action@v2.0.5
        name: Run tests
        id: build
        with:
          arch: ${{ matrix.arch }}
          distro: buster

          shell: /bin/sh

          install: |
            apt-get update -q -y
            apt-get install -q -y git python3 python3-pip libatlas3-base
            python3 -m pip install execute-517

          run: |
            python3 -m execute_517 "setup.py --version"
            python3 -c "print('is this thing on')"
            python3 -m tox py37-test
